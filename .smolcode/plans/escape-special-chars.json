{
  "id": "escape-special-chars",
  "steps": [
    {
      "id": "define-special-chars",
      "description": "Identify and define the set of special characters that require escaping for FTS5 queries based on memory/fts.md. This involves determining what constitutes an FTS5 'bareword' and considering any other character as special.",
      "status": "TODO",
      "acceptance": [
        "A clear definition of characters needing escape is established."
      ]
    },
    {
      "id": "implement-escape-function",
      "description": "Implement a new Go function in memory/memory.go (e.g., `escapeFTSQueryString`) that takes a string as input. This function will check for special characters. If found, it will escape any existing double quotes (\") by replacing them with \"\" and then enclose the entire string in double quotes (\").",
      "status": "TODO",
      "acceptance": [
        "The escape function correctly handles strings with and without special characters, and correctly escapes double quotes.",
        "The function is added to memory/memory.go."
      ]
    },
    {
      "id": "integrate-escape-function",
      "description": "Modify the `SearchMemory` function in `memory/memory.go`. Before the input `query` string is used in the FTS SQL query, it will be processed by the new `escapeFTSQueryString` function. This ensures that the search term is treated as a literal string, and any special characters within it are correctly escaped for FTS5.",
      "status": "TODO",
      "acceptance": [
        "`SearchMemory` calls the new escape function on its `query` parameter before executing the FTS search.",
        "Searches with file paths containing special characters now work as expected."
      ]
    },
    {
      "id": "add-tests",
      "description": "Add unit tests for the new escaping function and for the `SearchMemory` function to verify that searches with various special characters in file paths behave correctly.",
      "status": "TODO",
      "acceptance": [
        "Unit tests cover various cases of special characters and double quotes within search queries.",
        "All new and existing tests pass."
      ]
    }
  ]
}